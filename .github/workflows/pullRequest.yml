name: Notify pull request on Google Chat 

on:
  pull_request:
    branches:
      - main

jobs:
  notify_pull_request_google_chat:
      needs: [build, deploy]
      runs-on: ubuntu-latest
      steps:
        - name: Notify Google Chat
          if: ${{ always() }} # Utilisez 'always' pour vous assurer que la notification est envoy√©e m√™me en cas d'√©chec des √©tapes pr√©c√©dentes
          uses: SimonScholz/google-chat-action@main
          with:
            webhookUrl: ${{ secrets.GOOGLE_CHAT_URL }}
            title: ${{ needs.build.result == 'success' && needs.deploy.result == 'success' && 'D√©ploiement r√©ussi sur Thotify ! üöÄ' || '√âchec du d√©ploiement sur Thotify ‚ùå' }}
            subtitle: ${{ needs.build.result == 'success' && needs.deploy.result =='success' && 'Les modifications ont √©t√© fusionn√©es avec succ√®s ! üòª' || 'Il y √† eu une erreur lors de la mise en ligne..' }}
            additionalSections: |
              [              
                {
                  "header": "D√©tails de la fusion",
                  "collapsible": true,
                  "widgets": [
                    { "decoratedText": { "text": "- Titre du commit  : ${{github.event.commits[0].message}}" } },
                    { "decoratedText": { "text": "- Auteur : ${{ github.event.commits[1].author.username }}" } }
                  ]
                },
                {
                  "header": "R√©sultats des jobs",
                  "collapsible": true,
                  "widgets": [
                    { "decoratedText": { "text": "- Build : ${{ needs.build.result }}" } },
                    { "decoratedText": { "text": "- Deployment : ${{ needs.deploy.result }}" } }
                  ]
                }
              ]          




  